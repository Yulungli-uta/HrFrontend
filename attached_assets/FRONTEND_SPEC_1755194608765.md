# FRONTEND_SPEC.md — WsUtaSystem (UTA) — API de Talento Humano

**Versión:** v1  
**Base URL (local):** `http://localhost:5000`  
**OpenAPI (JSON):** `/openapi/v1.json`  
**Swagger UI:** `/swagger/index.html`  
**Auth:** (no aplica por ahora)

## Convenciones generales
- **DateOnly:** `YYYY-MM-DD` (ej. `"2025-08-14"`)
- **TimeOnly:** `HH:mm:ss` (ej. `"08:00:00"`)
- **DateTime (ISO 8601):** `YYYY-MM-DDTHH:mm:ssZ` (UTC)
- **Códigos HTTP:** `200 OK`, `201 Created`, `204 No Content`, `400 Bad Request`, `404 Not Found`, `409 Conflict`
- **Errores comunes BD:** violaciones de UNIQUE / FK → `409` ó `400` con mensaje
- **Headers:** `Content-Type: application/json`
- **Paginación/filtrado (futuro):** se sugiere `?page=1&size=20&search=...` (CRUD actual no pagina)

---

## 1) Personas — `/api/people`
**Modelo**
```ts
interface Person {
  id: number;
  firstName: string;      // req, max 100
  lastName: string;       // req, max 100
  idCard: string;         // req, único, max 20
  email: string;          // req, único, max 150
  phone?: string;         // max 30
  birthDate?: string;     // DateOnly
  sex?: 'M'|'F'|'O';      // char(1)
  gender?: string;        // max 50
  disability?: string;    // max 200
  address?: string;       // max 255
  isActive: boolean;      // default true
}
Endpoints

GET /api/people → Person[]

GET /api/people/{id}

POST /api/people

PUT /api/people/{id}

DELETE /api/people/{id} (borrado físico)
Ejemplo POST

json
Copiar
Editar
{ "firstName":"Henry","lastName":"Flores","idCard":"1802890176","email":"henry@uta.edu.ec","phone":"0999999999","isActive":true }
Validaciones sugeridas (UI): idCard: /^[0-9A-Za-z-]{5,20}$/, email válido, longitudes máximas.

2) Empleados — /api/employees
Modelo

ts
Copiar
Editar
type EmpType = 'Teacher_LOSE'|'Administrative_LOSEP'|'Employee_CT'|'Coordinator';
interface Employee {
  id: number;                 // = PersonID
  type: EmpType;              // req
  departmentId?: number;
  immediateBossId?: number;
  hireDate: string;           // DateOnly
  isActive: boolean;          // default true
}
Endpoints: CRUD completo.
Notas: id debe existir en People (FK).

3) Facultades — /api/faculties
ts
Copiar
Editar
interface Faculty { id:number; name:string; deanEmployeeId?:number; isActive:boolean; }
Endpoints: CRUD.
Regla: name max 120.

4) Departamentos — /api/departments
ts
Copiar
Editar
interface Department { id:number; facultyId?:number; name:string; isActive:boolean; }
Endpoints: CRUD.
Regla BD: (facultyId, name) único.

5) Horarios — /api/schedules
ts
Copiar
Editar
interface Schedule {
  id:number; description:string; entryTime:string; exitTime:string;
  workingDays:string;                 // ej: "1,2,3,4,5"
  requiredHoursPerDay:number;         // decimal(5,2)
  hasLunchBreak:boolean;              // default true
  lunchStart?:string; lunchEnd?:string;
  isRotating:boolean; rotationPattern?:string;
}
Endpoints: CRUD.

6) Asignación de Horarios — /api/employee-schedules
ts
Copiar
Editar
interface EmployeeSchedule { id:number; employeeId:number; scheduleId:number; validFrom:string; validTo?:string; }
Endpoints: CRUD.

7) Contratos — /api/contracts
ts
Copiar
Editar
interface Contract { id:number; employeeId:number; contractType:string; startDate:string; endDate?:string; baseSalary:number; }
Endpoints: CRUD.

8) Historial de Salarios — /api/salary-history
ts
Copiar
Editar
interface SalaryHistory {
  id:number; contractId:number; oldSalary:number; newSalary:number;
  changedBy:string; changedAt:string; reason?:string;
}
Endpoints: CRUD.

9) Tipos de Permiso — /api/permission-types
ts
Copiar
Editar
interface PermissionType { id:number; name:string; deductsFromVacation:boolean; requiresApproval:boolean; maxDays?:number; }
Endpoints: CRUD.

10) Permisos — /api/permissions
ts
Copiar
Editar
type PermissionStatus = 'Pending'|'Approved'|'Rejected';
interface Permission {
  id:number; employeeId:number; permissionTypeId:number;
  startDate:string; endDate:string;                  // DateOnly
  chargedToVacation:boolean; approvedBy?:number;
  justification?:string; requestDate:string;         // DateTime
  status:PermissionStatus; vacationId?:number;
}
Endpoints: CRUD.
Ejemplo POST

json
Copiar
Editar
{
  "employeeId": 12, "permissionTypeId": 3,
  "startDate": "2025-09-02", "endDate": "2025-09-02",
  "chargedToVacation": false,
  "requestDate": "2025-08-14T09:20:00Z",
  "status": "Pending",
  "justification": "Trámite personal"
}
11) Vacaciones — /api/vacations
ts
Copiar
Editar
type VacationStatus = 'Planned'|'InProgress'|'Completed'|'Canceled';
interface Vacation {
  id:number; employeeId:number; startDate:string; endDate:string;
  daysGranted:number; daysTaken:number; status:VacationStatus;
}
Endpoints: CRUD.

12) Picadas (Asistencia) — /api/attendance/punches
ts
Copiar
Editar
type PunchType = 'In'|'Out';
interface AttendancePunch {
  id:number; employeeId:number; punchTime:string;    // DateTime
  punchType:PunchType; deviceId?:string; longitude?:number; latitude?:number;
}
``]
**Endpoints:** CRUD.  
**Ejemplo POST**
```json
{ "employeeId":1,"punchTime":"2025-08-14T08:00:00Z","punchType":"In","deviceId":"WEB" }
13) Justificación de Picadas — /api/attendance/punch-justifications
ts
Copiar
Editar
interface PunchJustification {
  id:number; punchId:number; bossEmployeeId:number;
  reason:string; approved:boolean; approvedAt?:string;  // DateTime
}
Endpoints: CRUD.

14) Agregados de Asistencia — /api/attendance/calculations
ts
Copiar
Editar
type CalcStatus = 'Pending'|'Approved';
interface AttendanceCalculation {
  id:number; employeeId:number; workDate:string;       // DateOnly
  firstPunchIn?:string; lastPunchOut?:string;          // DateTime
  totalWorkedMinutes:number; regularMinutes:number; overtimeMinutes:number;
  nightMinutes:number; holidayMinutes:number; status:CalcStatus;
}
Endpoints: CRUD.

15) Configuración Horas Extra — /api/overtime/config
ts
Copiar
Editar
interface OvertimeConfig { overtimeType:string; factor:number; description?:string; }
Endpoints: CRUD.
Notas: overtimeType es la PK (string).

16) Horas Extra — /api/overtime
ts
Copiar
Editar
type OTStatus = 'Planned'|'Verified'|'Rejected'|'Paid';
interface Overtime {
  id:number; employeeId:number; workDate:string;       // DateOnly
  overtimeType:string; hours:number; status:OTStatus;
  approvedBy?:number; secondApprover?:number;
  factor:number; actualHours:number; paymentAmount:number;
}
Endpoints: CRUD.

17) Plan de Recuperación (Horas/Días) — /api/time-recovery/plans
ts
Copiar
Editar
interface TimeRecoveryPlan {
  id:number; employeeId:number; owedMinutes:number;
  planDate:string; fromTime:string; toTime:string;     // DateOnly + TimeOnly
  reason?:string; createdBy?:number;
}
Endpoints: CRUD.
Regla BD: bloque (To-From) debe cubrir owedMinutes y al menos 60 min.

18) Log de Recuperación — /api/time-recovery/logs
ts
Copiar
Editar
interface TimeRecoveryLog {
  id:number; recoveryPlanId:number;
  executedDate:string; minutesRecovered:number;
  approvedBy?:number; approvedAt?:string;              // DateTime
}
Endpoints: CRUD.

19) Subrogaciones — /api/subrogations
ts
Copiar
Editar
interface Subrogation {
  id:number; subrogatedEmployeeId:number; subrogatingEmployeeId:number;
  startDate:string; endDate:string; permissionId?:number; vacationId?:number; reason?:string;
}
Endpoints: CRUD.
Regla BD: endDate >= startDate.

20) Movimientos de Personal — /api/personnel-movements
ts
Copiar
Editar
type MovementType = 'Transfer'|'Promotion'|'Demotion'|'Lateral';
interface PersonnelMovement {
  id:number; employeeId:number; contractId:number;
  originDepartmentId?:number; destinationDepartmentId:number;
  movementDate:string; movementType:MovementType;
  documentLocation?:string; reason?:string; createdBy?:number;
}
Endpoints: CRUD.

21) Nómina — /api/payroll
ts
Copiar
Editar
type PayrollStatus = 'Pending'|'Paid'|'Reconciled';
interface Payroll {
  id:number; employeeId:number; period:string;         // "YYYY-MM"
  baseSalary:number; status:PayrollStatus;
  paymentDate?:string; bankAccount?:string;
}
Endpoints: CRUD.
Regla BD: (employeeId, period) único.

Ejemplo POST

json
Copiar
Editar
{ "employeeId":12,"period":"2025-08","baseSalary":1200.00,"status":"Pending" }
22) Detalle de Nómina — /api/payroll-lines
ts
Copiar
Editar
type LineType = 'Earning'|'Deduction'|'Subsidy'|'Overtime';
interface PayrollLine {
  id:number; payrollId:number; lineType:LineType; concept:string;
  quantity:number; unitValue:number; notes?:string;
}
Endpoints: CRUD.

Ejemplo POST

json
Copiar
Editar
{ "payrollId":1, "lineType":"Earning", "concept":"Bono por desempeño", "quantity":1, "unitValue":100.00 }
23) Auditoría — /api/audit
ts
Copiar
Editar
interface Audit {
  id:number;                 // BIGINT (long)
  tableName:string; action:string; recordID:string; userName:string;
  dateTime:string;           // DateTime
  details?:string;
}
Endpoints: CRUD (lectura principal). Nota: normalmente solo lectura/consulta; escritura suele ser automática por triggers o lógica de backend (a definir).

Ejemplos rápidos (end-to-end)
Crear Persona → Empleado → Contrato
http
Copiar
Editar
POST /api/people
{ "firstName":"Ana","lastName":"Vega","idCard":"1720012345","email":"ana.vega@uta.edu.ec","isActive":true }

POST /api/employees
{ "id": 1, "type": "Administrative_LOSEP", "hireDate": "2025-08-01", "isActive": true }

POST /api/contracts
{ "employeeId": 1, "contractType": "Indefinido", "startDate":"2025-08-01", "baseSalary": 1350.00 }
Picadas y justificativo
http
Copiar
Editar
POST /api/attendance/punches
{ "employeeId":1,"punchTime":"2025-08-14T08:00:00Z","punchType":"In","deviceId":"WEB" }

POST /api/attendance/punch-justifications
{ "punchId": 1, "bossEmployeeId": 5, "reason": "Retraso por cita médica", "approved": false }
Permiso + Subrogación
http
Copiar
Editar
POST /api/permissions
{ "employeeId":1,"permissionTypeId":2,"startDate":"2025-09-01","endDate":"2025-09-01","chargedToVacation":false,"requestDate":"2025-08-14T09:20:00Z","status":"Pending" }

POST /api/subrogations
{ "subrogatedEmployeeId":1,"subrogatingEmployeeId":7,"startDate":"2025-09-01","endDate":"2025-09-01","permissionId":1,"reason":"Cobertura por permiso"}
Nómina + Detalles
http
Copiar
Editar
POST /api/payroll
{ "employeeId":1,"period":"2025-08","baseSalary":1350.00,"status":"Pending" }

POST /api/payroll-lines
{ "payrollId":1,"lineType":"Overtime","concept":"Horas extra nocturnas","quantity":6,"unitValue":5.50 }
Validaciones sugeridas en Frontend (resumen)
idCard: /^[0-9A-Za-z-]{5,20}$/

email: RFC (lib de validación)

period: /^\d{4}-(0[1-9]|1[0-2])$/

hours, quantity, unitValue, baseSalary, owedMinutes > 0

endDate >= startDate (vacaciones, permisos, subrogaciones)

lineType ∈ {Earning,Deduction,Subsidy,Overtime}

status válido en cada recurso (Permits, Vacation, Overtime, Payroll)

Longitudes: respetar comentarios de max

Para el detalle exacto de tipos, constraints y ejemplos generados automáticamente, consultar /openapi/v1.json o la UI /swagger/index.html.

makefile
Copiar
Editar
::contentReference[oaicite:0]{index=0}